# 军用无人机侦查任务Agent群组系统

### 简介

本系统使用LangGraph框架构建军用无人机侦查任务Agent群组协作系统，实现基于大语言模型的多Agent任务协作与人机交互。系统采用supervisor-agent架构，能够协调多个专业化Agent完成复杂侦察任务。

### 功能特性

- **模块化架构**：系统由主入口、配置模块、模型服务、无人机模拟器、Agent模块和Supervisor模块组成
- **核心功能**：
  - Supervisor负责任务分析、规划和协调
  - 航线规划Agent群组(SAR和光电)
  - 情报处理Agent群组(SAR和光电)
  - 无人机状态模拟器
  - LangSmith集成
  - **人在回路交互**：支持在关键决策点引入人类干预

### 工作流程

1. 接收区域侦查任务和目标坐标
2. 分析任务并制定执行计划
3. 规划SAR航线并执行SAR任务（**含人工审核**）
4. 处理SAR数据并识别目标（**含人工审核**）
5. 规划光电航线并执行光电任务（**含人工审核**）
6. 处理光电数据并确认目标
7. 生成任务报告

### 人在回路交互

系统实现了真正的人在回路交互功能，使用LangGraph的interrupt()和Command机制，在关键决策点允许人类操作员参与决策。

#### 人在回路交互点

1. **SAR航线规划**：
   - 操作员可审核生成的航线
   - 提供接受或修改航线的选项

2. **SAR数据处理**：
   - 操作员可审核目标识别结果
   - 提供接受、过滤目标或添加漏检目标的选项

3. **光电航线规划**：
   - 操作员可审核生成的光电航线
   - 提供接受、修改航线或调整目标优先级的选项

#### 交互示例

```
=================================================
需要人工干预:
SAR航线规划已完成，请审核以下航线是否满足任务要求:

SAR航线规划结果:

航线描述: [航线描述内容]

航线点:
[航线点详细信息]

高度: 3000 米
速度: 150 米/秒

请选择: 'accept' 接受航线, 'edit' 修改航线
=================================================

可选操作:
1. accept - 接受SAR航线
2. edit - 修改SAR航线 (输入修改意见)

请输入操作 (例如 'accept'): 
```

### 技术实现

系统利用LangGraph的状态管理和工作流编排能力，实现了复杂Agent协作工作流：

1. **状态设计**：使用不可变状态模式，确保状态更新的一致性
2. **工作流机制**：使用StateGraph构建有向图工作流
3. **人在回路实现**：
   - 使用interrupt()方法暂停工作流执行
   - 使用Command(resume=...)方法继续工作流执行
   - 利用InMemorySaver保存工作流状态

### 运行方式

```bash
# 安装依赖
pip install -r requirements.txt

# 运行主程序
python main.py
```

### 依赖项

- langchain>=0.1.0
- langgraph>=0.0.20
- langchain-core>=0.1.10
- langchain-community>=0.0.13
- langchain-deepseek>=0.0.1  
- langsmith>=0.0.77
- python-dotenv>=1.0.0

### 项目结构

```
├── agents/                      # Agent模块
│   ├── __init__.py             
│   ├── common.py                # Agent通用组件
│   ├── planning_agents.py       # 航线规划相关Agent
│   └── processing_agents.py     # 情报处理相关Agent
├── supervisor/                  # Supervisor模块
│   ├── __init__.py
│   ├── state.py                 # 状态定义
│   └── workflow.py              # 工作流定义
├── aircraft_simulator.py        # 无人机状态模拟器
├── config.py                    # 配置文件
├── main.py                      # 主入口
├── models.py                    # 模型服务
└── requirements.txt             # 依赖包
```

## 功能特点

- **统一工作流架构**：使用LangGraph构建分层和顺序执行的工作流
- **模块化设计**：各个组件高内聚低耦合，便于测试和扩展
- **状态监控系统**：实时监控无人机状态和任务执行情况
- **人在回路**：在关键决策点保留人类干预的能力
- **LangSmith集成**：支持全链路追踪和性能监控

## 安装与运行

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行示例

```bash
python main.py
```

## 核心组件

### 1. Supervisor Agent

负责任务分析、规划和协调。对于区域侦查任务，它会：
- 分析任务要求和目标区域信息
- 拆解任务为一系列执行步骤
- 根据无人机状态分配适当的子任务
- 监控任务执行过程

### 2. 航线规划Agent群组

包含两种规划Agent：
- **SAR航线规划Agent**：负责规划SAR载荷的侦查航线
- **光电航线规划Agent**：负责规划光电载荷的侦查航线

### 3. 情报处理Agent群组

包含两种处理Agent：
- **SAR图像处理Agent**：处理SAR图像，识别目标
- **光电图像处理Agent**：处理光电图像，确认目标

### 4. 无人机状态模拟器

模拟无人机的飞行状态和任务执行过程，包括：
- 地面准备、起飞、执行任务、返航等状态
- 模拟SAR和光电数据采集
- 提供状态变更通知机制

## 工作流程

1. 接收区域侦查任务和目标坐标
2. Supervisor分析任务并制定执行计划
3. 调用SAR航线规划Agent规划SAR侦查航线
4. 模拟无人机执行SAR任务
5. 调用SAR图像处理Agent处理数据，识别目标
6. 调用光电航线规划Agent规划光电侦查航线
7. 模拟无人机执行光电任务
8. 调用光电图像处理Agent处理数据，确认目标
9. 生成任务报告和目标信息

## 扩展与优化

本项目设计为原型验证系统，后续可以扩展：

1. 接入真实无人机控制系统
2. 实现真实的图像处理功能
3. 增加更多类型的载荷和Agent
4. 增强决策能力和异常处理
5. 优化Agent间协作机制 